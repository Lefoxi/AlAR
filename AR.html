<html>
<head>
	<title>(Заміни на назву своєї роботи)Віртуальна хімічна лабораторія у доповненій реальності</title>
	<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
	<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
<script>

/
const howmuch=1.4;

let isReaction = false;
let distance = howmuch+1;

//для хранения состояния видимости маркера с заданным номером
let markerVisible = [ false, false, false, false, false, false, false, false, false, false ]; 

//для хранения маркеров
let M = [ null, null, null, null, null, null, null, null, null, null ]; 

//для хранения накладывающихся на маркер объектов - плоскости
let d = [ null, null, null, null, null, null, null, null, null, null ]; 

//для хранения связанных с маркером объектов - видео
let X = [
  [null, null, null, null, null, null, null, null, null, null],
  [null, null, null, null, null, null, null, null, null, null],
  [null, null, null, null, null, null, null, null, null, null],
  [null, null, null, null, null, null, null, null, null, null],
  [null, null, null, null, null, null, null, null, null, null],
  [null, null, null, null, null, null, null, null, null, null],
  [null, null, null, null, null, null, null, null, null, null],
  [null, null, null, null, null, null, null, null, null, null],
  [null, null, null, null, null, null, null, null, null, null],
  [null, null, null, null, null, null, null, null, null, null],
] ;//[ false, false, false, false, false, false, false, false, false, false ]; 

//для хранения координат центров маркеров
let p = [ null, null, null, null, null, null, null, null, null, null ]; 

AFRAME.registerComponent('registerevents', { 
  init: function () { 
    let marker = this.el; 
    marker.addEventListener('markerFound', function() { 
      index = parseInt(marker.id[1])
      markerVisible[ index ] = true; 
      d[index] = document.querySelector("#draw"+index); 
      //X[index] = document.querySelector("#drawX"+index); 
      if(d[index]!=null)
        d[index].setAttribute("visible", "true");
//      console.log("Found M = "+index);   
    }); 
    marker.addEventListener('markerLost', function() { 
      index = parseInt(marker.id[1])
      markerVisible[ index ] = false; 
      if(d[index]!=null)
        d[index].setAttribute("visible", "false");
//      console.log("Lost M = "+index);   
    }); 
  } 
}); 

isVideoPlay = false;

AFRAME.registerComponent('run', { 
  init: function() { 
    for (let i = 0; i < 10 ; i++)
    {
       M[i] = document.querySelector("#M"+i); 
       d[i] = document.querySelector("#draw"+i); 
       p[i] = new THREE.Vector3(); 
       if (markerVisible [i])
          d[i].setAttribute("visible", "true");
    }

    for (let i = 0; i < 10 ; i++)
      for (let j = 0; j < 10 ; j++)
         if(i!=j)
           X[i][j] = document.querySelector("#drawX"+i+""+j); 

  }, 
 
  tick: function (time, deltaTime) { 
    //маркеры с какими номерами видны
    let visible = [] 
    for (let i=0;i<10;i++)
      if (markerVisible[i]==true)
         visible.push(i)//добавить в массив номер маркер

   

    
    

    if(isReaction) //если идет реакция
    {
       if(!isVideoPlay)
       {
         if(d[marker1]!=null) d[marker1].setAttribute("visible", "false");
         if(d[marker2]!=null) d[marker2].setAttribute("visible", "false");
         X[marker1][marker2].setAttribute("visible", "true");
	 var id="#"+X[marker1][marker2].getAttribute("material").src.getAttribute("id");
         var video=document.querySelector(id);
         video.currentTime=0;
         video.play();
         isVideoPlay = true;
       }
    }
    else
    {
       if(d[marker1]!=null) d[marker1].setAttribute("visible", "true");
       if(d[marker2]!=null) d[marker2].setAttribute("visible", "true");
       X[marker1][marker2].setAttribute("visible", "false");
       var id="#"+X[marker1][marker2].getAttribute("material").src.getAttribute("id");
       var video=document.querySelector(id);
       video.currentTime=0;
       video.pause();
       isVideoPlay = false;
    }

  } 
}); 

</script>
</head>

<body>
<a-scene 
    vr-mode-ui="enabled: false;"
    renderer="logarithmicDepthBuffer: true;"
    embedded
    arjs="trackingMethod: best; sourceType: webcam;debugUIEnabled: false;"
  >

  <a-assets>
    <video id="video1" preload="auto" muted poster="images/images.jpg" loop="false" src="video.mp4"></video>
  </a-assets>



  <a-marker type="pattern" url="markers/pattern.patt" id="M0" registerevents> 
    <a-plane src="images.jpg" rotation="-90 90 0" id="draw0"></a-plane>
    <a-entity material="shader: flat; src: #video" geometry="primitive: plane; width: 0.90; height: 1.60;" position="0 0 0" scale="1.5 1.5 1.5"
				rotation="-90 0 0" id="drawX01" visible="false"></a-entity>	  
  </a-marker> 

 

  <a-entity camera></a-entity> 
  <a-entity run></a-entity> 
</a-scene> 

</body>
</html>